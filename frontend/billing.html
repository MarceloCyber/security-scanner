<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faturas - Iron Net</title>
    <link rel="stylesheet" href="css/modern-style.css?v=6.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .container { max-width: 1100px; margin: 0 auto; padding: 30px 20px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .page-header h1 { display: flex; align-items: center; gap: 10px; }
        .card { background: #1a1d29; border-radius: 12px; padding: 20px; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .table th { text-align: left; color: #a0aec0; font-weight: 600; }
        .status-badge { padding: 6px 10px; border-radius: 12px; font-size: 0.85em; }
        .status-paid { background: #48bb78; color: white; }
        .status-open { background: #ed8936; color: white; }
        .status-draft { background: #718096; color: white; }
        .actions a { color: #667eea; text-decoration: none; margin-right: 10px; }
        .empty { text-align: center; color: #a0aec0; padding: 20px; }
        .back { color: #667eea; text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-file-invoice"></i> Faturas</h1>
            <a class="back" href="dashboard.html"><i class="fas fa-arrow-left"></i> Voltar</a>
        </div>
        <div class="card">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Status</th>
                        <th>Valor</th>
                        <th>Data</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="invoicesBody">
                    <tr><td colspan="5" class="empty"><i class="fas fa-spinner fa-spin"></i> Carregando...</td></tr>
                </tbody>
            </table>
        </div>
        <div style="text-align:center; color:#a0aec0; font-size:0.9em; margin-top: 10px;">
            Ao usar a plataforma, você concorda com os <a href="terms.html" class="back">Termos de Uso</a> e a <a href="privacy.html" class="back">Política de Privacidade</a>.
        </div>
    </div>

    <script>
        async function fetchInvoices() {
            try {
                const token = localStorage.getItem('access_token') || localStorage.getItem('token');
                if (!token) {
                    window.location.href = 'index.html';
                    return;
                }
                const res = await fetch('/api/payments/invoices', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                const tbody = document.getElementById('invoicesBody');
                const invoices = data.invoices || [];
                if (invoices.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty">Nenhuma fatura encontrada</td></tr>';
                    return;
                }
                tbody.innerHTML = invoices.map(inv => {
                    const statusClass = inv.status === 'paid' ? 'status-paid' : inv.status === 'open' ? 'status-open' : 'status-draft';
                    const amountBRL = (inv.amount_paid / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                    const dateStr = inv.created ? new Date(inv.created).toLocaleString('pt-BR') : '-';
                    const viewLink = inv.hosted_invoice_url ? `<a href="${inv.hosted_invoice_url}" target="_blank" rel="noopener"><i class="fas fa-eye"></i> Visualizar</a>` : '';
                    const pdfLink = inv.invoice_pdf ? `<a href="${inv.invoice_pdf}" target="_blank" rel="noopener"><i class="fas fa-file-pdf"></i> PDF</a>` : '';
                    return `
                        <tr>
                            <td>${inv.id}</td>
                            <td><span class="status-badge ${statusClass}">${inv.status || '-'}</span></td>
                            <td>${amountBRL}</td>
                            <td>${dateStr}</td>
                            <td class="actions">${viewLink} ${pdfLink}</td>
                        </tr>
                    `;
                }).join('');
            } catch (err) {
                console.error('Erro ao carregar faturas:', err);
                document.getElementById('invoicesBody').innerHTML = '<tr><td colspan="5" class="empty">Erro ao carregar faturas</td></tr>';
            }
        }
        document.addEventListener('DOMContentLoaded', fetchInvoices);
    </script>
</body>
</html>
